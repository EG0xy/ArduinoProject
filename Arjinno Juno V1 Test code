//Testing code for Arjinno V1
// LED 13, 12, 11, 10, 9, 8

#include <Wire.h>
#include <LiquidCrystal.h> // 16x02 LCD library
#include "ClickButton.h"  // button library
LiquidCrystal lcd(7, 6, 5, 4, 3, 2);

ClickButton ba(A0, LOW, CLICKBTN_PULLUP);
ClickButton bb(A1, LOW, CLICKBTN_PULLUP);
ClickButton bc(A2, LOW, CLICKBTN_PULLUP);

int lcdlight = 0; //LCD backlight
int beeper = 1;   // beeper pin
int relay = 8;    // relay pin
int potL = A7;    // left potentiometer (can be use as an input and calibration)
int potR = A6;    // Right potentiometer bigger one, mainly use as an input device


unsigned long t1 = 0;
unsigned long t2 = 0;
unsigned long t3 = 0;
unsigned long t4 = 0;
unsigned long t5 = 0;
unsigned long t6 = 0;

int tsec = 0;
int tmin = 0;
int thr = 0;
int toggle = 0;
int led=0;
int beep=0;

int sound=1;
int light=1;
int ledout=1;

int rightPot = 0;
int leftPot=0;

void setup() {
  lcd.begin(16, 2);
  digitalWrite (lcdlight, HIGH); // turn on the LCD light  
  ba.multiclickTime = 50;
  bb.multiclickTime = 50;
  bc.multiclickTime = 50;

  pinMode (13, OUTPUT); //6 leds; led 8 is connected to relay;
  pinMode (12, OUTPUT);
  pinMode (11, OUTPUT);
  pinMode (10, OUTPUT);
  pinMode (9, OUTPUT);
  
  pinMode (lcdlight, OUTPUT);
  pinMode (beeper, OUTPUT);
  pinMode (relay, OUTPUT);
  pinMode (potL, INPUT);
  pinMode (potR, INPUT);
}

void loop() {
  ba.Update();
  bb.Update();
  bc.Update();


  digitalWrite (lcdlight, light);

  // 3 buttons
  if(ba.clicks==1)  light=!light ;  // toggle lcd screen light
  if(bb.clicks==1)  ledout=!ledout; // toggle LED output 
  if(bc.clicks==1)  sound=!sound; // toggle beeper   

  //--------------------------------------------  
  //clock code and LCD line A print out
  t1 = millis();
  if (t1 - t2 >= 1000) {
    tsec++;
    toggle = !toggle;

    t2 = t1;
  }
  
  if(tsec==60){tsec=0; tmin++;}
  if(tmin==60){tmin=0; thr++;}
  if(thr==12){thr=0;}
  
  char lineA[17];
  sprintf(lineA, "Time:%02d:%02d:%02d :)", thr, tmin, tsec );
  lcd.setCursor (0,0); 
  lcd.print (lineA);
  
  //--------------------------------------------
  // use right pot to control flashing LED speed
  int bufferR = analogRead (potR);
  rightPot = map(bufferR, 0, 1023, 10, 1000); 
  
  t3 = millis();
  if (t3 - t4 >= rightPot) {
    led=!led;
    t4 = t3;
  }  
  
  if (ledout==1){
  
    digitalWrite (13, led);
    digitalWrite (12, led);
    digitalWrite (11, led);
    digitalWrite (10, led);
    digitalWrite (9, led);
   digitalWrite (relay, toggle); // toggle relay every second; For the sound effect.
  }
   else{
    digitalWrite (13, LOW);
    digitalWrite (12, LOW);
    digitalWrite (11, LOW);
    digitalWrite (10, LOW);
    digitalWrite (9, LOW);
   digitalWrite (relay, LOW);   
   }
  
  //--------------------------------------------
  // use LED pot to control Beeper sound frequency  
   int bufferL = analogRead (potL);
  leftPot = map(bufferL, 0, 1023, 5, 1000);  

  t5 = millis();
  if (t5 - t6 >= leftPot) {
    beep=!beep;
    t6 = t5;
  }  
  
  if(sound==1) digitalWrite (beeper, beep);
  else digitalWrite (beeper, LOW);
  
 
   //--------------------------------------------
  // Print out the values from 2 pots
   char lineB[17];
  sprintf(lineB, "L:%04d R:%04d", leftPot, rightPot );
  lcd.setCursor (0,1); 
  lcd.print (lineB);
  
}
